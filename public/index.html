<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ZAHA AI</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            html {
                -webkit-text-size-adjust: 100%;
            }

            @media (max-width: 600px) {
                body {
                    padding: 8px;
                    padding-bottom: calc(8px + env(safe-area-inset-bottom, 0px));
                }
            }

            :root {
                --accent: #38C1B7;
                --accent-dark: #2da69a;
                --success: #34d399;
                --text-primary: #1f2937;
                --text-secondary: #6b7280;
                --border-light: #e5e7eb;
                --bg-subtle: #f9fafb;
                --bg-card: #ffffff;
                --shadow: 0 4px 20px rgba(56, 193, 183, 0.12);
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu,
                    Cantarell, sans-serif;
                background: var(--bg-subtle);
                min-height: 100vh;
                padding: 12px;
                padding-bottom: calc(12px + env(safe-area-inset-bottom, 0px));
                color: var(--text-primary);
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                background: var(--bg-card);
                border-radius: 20px;
                box-shadow: var(--shadow);
                overflow: hidden;
                border: 1px solid var(--border-light);
            }

            @media (max-width: 600px) {
                .container {
                    border-radius: 12px;
                    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
                }
            }

            .header {
                background: var(--bg-card);
                color: var(--text-primary);
                border-bottom: 1px solid var(--border-light);
                padding: 30px;
                text-align: center;
            }

            .header h1 {
                font-size: 2.5em;
                margin-bottom: 10px;
                background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            .header p {
                color: var(--text-secondary);
                font-size: 1.1em;
            }

            @media (max-width: 768px) {
                .header {
                    padding: 24px 20px;
                }
                .header h1 {
                    font-size: 2em;
                }
                .header p {
                    font-size: 1em;
                }
            }

            @media (max-width: 480px) {
                .header {
                    padding: 20px 16px;
                }
                .header h1 {
                    font-size: 1.6em;
                }
                .header p {
                    font-size: 0.95em;
                }
            }

            .footer {
                text-align: center;
                padding: 24px 30px;
                background: var(--bg-subtle);
                border-top: 1px solid var(--border-light);
                color: var(--text-secondary);
                font-size: 0.95em;
            }

            .footer p {
                margin: 4px 0;
            }

            .footer-credit {
                font-size: 0.85em;
                color: var(--text-secondary);
                opacity: 0.9;
            }

            @media (max-width: 768px) {
                .footer {
                    padding: 20px 24px;
                    font-size: 0.9em;
                }
            }

            @media (max-width: 480px) {
                .footer {
                    padding: 16px;
                    font-size: 0.85em;
                }
            }

            .content {
                padding: 40px;
            }

            @media (max-width: 768px) {
                .content {
                    padding: 24px;
                }
            }

            @media (max-width: 480px) {
                .content {
                    padding: 16px;
                }
            }

            .upload-section {
                margin-bottom: 30px;
            }

            .upload-section h2 {
                color: var(--text-primary);
                margin-bottom: 15px;
                font-size: 1.5em;
            }

            @media (max-width: 480px) {
                .upload-section h2 {
                    font-size: 1.25em;
                }
            }

            .upload-area {
                border: 2px dashed var(--accent);
                border-radius: 15px;
                padding: 40px;
                text-align: center;
                background: var(--bg-subtle);
                min-height: 140px;
                transition: all 0.3s ease;
                cursor: pointer;
                position: relative;
                -webkit-tap-highlight-color: transparent;
            }

            .upload-area:hover {
                border-color: var(--accent-dark);
                background: rgba(56, 193, 183, 0.06);
            }

            .upload-area.dragover {
                border-color: var(--accent-dark);
                background: rgba(56, 193, 183, 0.1);
            }

            .upload-area.has-image {
                border-color: var(--success);
                border-style: solid;
                background: rgba(52, 211, 153, 0.08);
            }

            .upload-area input[type='file'] {
                display: none;
            }

            .upload-icon {
                font-size: 4em;
                margin-bottom: 20px;
            }

            .upload-text {
                font-size: 1.2em;
                color: var(--text-secondary);
                margin-bottom: 10px;
            }

            .upload-hint {
                font-size: 0.9em;
                color: var(--text-secondary);
                opacity: 0.8;
            }

            @media (max-width: 768px) {
                .upload-area {
                    padding: 28px 20px;
                }
                .upload-icon {
                    font-size: 3em;
                    margin-bottom: 14px;
                }
                .upload-text {
                    font-size: 1.1em;
                }
                .upload-hint {
                    font-size: 0.85em;
                }
            }

            @media (max-width: 480px) {
                .upload-area {
                    padding: 20px 16px;
                    min-height: 120px;
                }
                .upload-icon {
                    font-size: 2.5em;
                    margin-bottom: 12px;
                }
                .upload-text {
                    font-size: 1em;
                }
                .upload-hint {
                    font-size: 0.8em;
                }
            }

            .image-preview-container {
                margin-top: 20px;
                position: relative;
            }

            .image-preview {
                max-width: 100%;
                max-height: 300px;
                border-radius: 10px;
                box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
                border: 1px solid var(--border-light);
            }

            @media (max-width: 768px) {
                .image-preview {
                    max-height: 240px;
                }
            }

            @media (max-width: 480px) {
                .image-preview {
                    max-height: 200px;
                }
            }

            .remove-image {
                position: absolute;
                top: 10px;
                right: 10px;
                background: #ef4444;
                color: white;
                border: none;
                border-radius: 50%;
                width: 30px;
                height: 30px;
                min-width: 30px;
                min-height: 30px;
                cursor: pointer;
                font-size: 18px;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: background 0.2s;
            }

            .remove-image:hover {
                background: #dc2626;
            }

            .btn {
                background: var(--accent);
                color: white;
                border: none;
                padding: 15px 40px;
                font-size: 1.1em;
                border-radius: 10px;
                cursor: pointer;
                -webkit-tap-highlight-color: transparent;
                transition:
                    transform 0.2s,
                    box-shadow 0.2s,
                    background 0.2s;
                margin-top: 20px;
                width: 100%;
            }

            .btn:hover {
                background: var(--accent-dark);
                transform: translateY(-2px);
                box-shadow: 0 8px 24px rgba(56, 193, 183, 0.35);
            }

            .btn:disabled {
                opacity: 0.6;
                cursor: not-allowed;
                transform: none;
            }

            @media (max-width: 480px) {
                .btn {
                    padding: 14px 24px;
                    font-size: 1em;
                }
            }

            .results {
                margin-top: 40px;
            }

            .result-section {
                margin-bottom: 30px;
            }

            .result-section h3 {
                color: var(--text-primary);
                margin-bottom: 15px;
                font-size: 1.3em;
            }

            .result-images {
                display: grid;
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .result-card {
                background: var(--bg-subtle);
                border-radius: 15px;
                padding: 20px;
                box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
                border: 1px solid var(--border-light);
            }

            .result-card img {
                width: 100%;
                border-radius: 10px;
                box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
                border: 1px solid var(--border-light);
            }

            .result-grid {
                display: grid;
                grid-template-columns: 1fr 1fr 1fr;
                gap: 15px;
                padding: 20px;
                align-items: stretch;
            }

            .result-grid-item {
                display: flex;
                flex-direction: column;
                min-width: 0;
                overflow: hidden;
            }

            .result-grid-item h4 {
                margin-bottom: 10px;
                color: var(--accent);
                font-size: 1em;
                text-align: center;
                flex-shrink: 0;
            }

            .result-grid-item .result-image-wrapper {
                flex: 1;
                min-height: 0;
                display: flex;
                align-items: center;
                justify-content: center;
                background: var(--bg-card);
                border-radius: 10px;
                border: 1px solid var(--border-light);
                overflow: hidden;
                aspect-ratio: 1;
            }

            .result-grid-item img {
                width: 100%;
                height: 100%;
                object-fit: contain;
                cursor: pointer;
                transition: transform 0.2s;
                border-radius: 10px;
            }

            .result-grid-item img:hover {
                transform: scale(1.03);
            }

            /* Modal Styles */
            .modal {
                display: none;
                position: fixed;
                z-index: 1000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.9);
                animation: fadeIn 0.3s;
            }

            .modal.show {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                }
                to {
                    opacity: 1;
                }
            }

            .modal-content {
                position: relative;
                max-width: 95%;
                max-height: 95%;
                margin: auto;
                animation: zoomIn 0.3s;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 12px;
            }

            @keyframes zoomIn {
                from {
                    transform: scale(0.8);
                    opacity: 0;
                }
                to {
                    transform: scale(1);
                    opacity: 1;
                }
            }

            .modal-image-container {
                overflow: auto;
                max-width: 100%;
                max-height: 80vh;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 10px;
                background: rgba(0, 0, 0, 0.3);
            }

            .modal-content img {
                max-width: 100%;
                height: auto;
                max-height: 80vh;
                object-fit: contain;
                border-radius: 10px;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
                transition: transform 0.15s ease-out;
                transform-origin: center center;
            }

            .modal-zoom-controls {
                display: flex;
                align-items: center;
                gap: 12px;
                background: rgba(0, 0, 0, 0.6);
                padding: 8px 16px;
                border-radius: 24px;
            }

            .modal-zoom-btn {
                background: var(--accent);
                color: white;
                border: none;
                width: 36px;
                height: 36px;
                border-radius: 50%;
                font-size: 24px;
                line-height: 1;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: background 0.2s;
                -webkit-tap-highlight-color: transparent;
            }

            .modal-zoom-btn:hover {
                background: var(--accent-dark);
            }

            .modal-zoom-level {
                color: white;
                font-size: 0.9em;
                min-width: 48px;
                text-align: center;
            }

            .modal-close {
                position: absolute;
                top: -40px;
                right: 0;
                color: #fff;
                font-size: 40px;
                font-weight: bold;
                cursor: pointer;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 50%;
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: background 0.2s;
            }

            .modal-close:hover {
                background: rgba(0, 0, 0, 0.8);
            }

            @media (max-width: 768px) {
                .modal-content {
                    max-width: 95%;
                    max-height: 90%;
                }
                .modal-image-container {
                    max-height: 70vh;
                }
                .modal-zoom-btn {
                    width: 40px;
                    height: 40px;
                    font-size: 26px;
                }
                .modal-close {
                    top: -36px;
                    right: 10px;
                    font-size: 32px;
                    width: 36px;
                    height: 36px;
                    padding-top: env(safe-area-inset-top, 0);
                }
            }

            @media (max-width: 480px) {
                .modal-content {
                    max-width: 96%;
                    max-height: 90%;
                }
                .modal-image-container {
                    max-height: 60vh;
                }
                .modal-content img {
                    max-height: 60vh;
                }
                .modal-zoom-btn {
                    width: 44px;
                    height: 44px;
                    font-size: 28px;
                }
                .modal-close {
                    top: -32px;
                    right: 8px;
                    font-size: 28px;
                    width: 32px;
                    height: 32px;
                }
            }

            @media (min-width: 769px) and (max-width: 1024px) {
                .result-grid {
                    grid-template-columns: 1fr 1fr 1fr;
                    gap: 12px;
                    padding: 16px;
                }
            }

            @media (max-width: 768px) {
                .result-grid {
                    grid-template-columns: 1fr 1fr 1fr;
                    gap: 10px;
                    padding: 12px;
                }
                .result-grid-item h4 {
                    font-size: 0.85em;
                }
                .result-grid-item .result-image-wrapper {
                    aspect-ratio: 1;
                    min-height: 80px;
                    max-height: 110px;
                }
            }

            @media (max-width: 480px) {
                .result-grid {
                    grid-template-columns: 1fr 1fr 1fr;
                    gap: 8px;
                    padding: 12px;
                }
                .result-card {
                    padding: 16px;
                }
                .result-section h3 {
                    font-size: 1.15em;
                }
                .result-grid-item h4 {
                    font-size: 0.75em;
                }
                .result-grid-item .result-image-wrapper {
                    aspect-ratio: 1;
                    min-height: 70px;
                    max-height: 95px;
                }
            }

            .input-section {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 30px;
                margin-bottom: 30px;
            }

            @media (max-width: 900px) {
                .input-section {
                    grid-template-columns: 1fr;
                    gap: 24px;
                }
            }

            @media (max-width: 480px) {
                .input-section {
                    gap: 20px;
                    margin-bottom: 20px;
                }
            }

            .loading {
                text-align: center;
                padding: 40px;
                color: var(--accent);
            }

            @media (max-width: 480px) {
                .loading {
                    padding: 24px 16px;
                    font-size: 0.95em;
                }
            }

            .spinner {
                border: 4px solid var(--border-light);
                border-top: 4px solid var(--accent);
                border-radius: 50%;
                width: 50px;
                height: 50px;
                animation: spin 1s linear infinite;
                margin: 20px auto;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            .error {
                background: #fef2f2;
                color: #dc2626;
                padding: 15px;
                border-radius: 10px;
                margin-top: 20px;
                border-left: 4px solid #ef4444;
            }

            .hidden {
                display: none;
            }

            /* ========== App Nav & Page Sections ========== */
            .app-nav {
                position: sticky;
                top: 0;
                z-index: 100;
                background: var(--bg-card);
                border-bottom: 1px solid var(--border-light);
                padding: 12px 24px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            }
            .app-nav-brand {
                font-size: 1.5em;
                font-weight: 700;
                background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                cursor: pointer;
                transition: opacity 0.2s;
            }
            .app-nav-brand:hover { opacity: 0.85; }
            .app-nav-links {
                display: flex;
                gap: 20px;
            }
            .app-nav-links a {
                color: var(--text-secondary);
                text-decoration: none;
                font-weight: 500;
                transition: color 0.2s;
            }
            .app-nav-links a:hover, .app-nav-links a.active {
                color: var(--accent);
            }
            .page-section {
                display: none;
                animation: pageFadeIn 0.4s ease-out;
            }
            .page-section.active {
                display: block;
            }
            @keyframes pageFadeIn {
                from { opacity: 0; transform: translateY(8px); }
                to { opacity: 1; transform: translateY(0); }
            }

            /* ========== Landing Page ========== */
            .landing-hero {
                text-align: center;
                padding: 60px 24px;
                background: linear-gradient(180deg, rgba(56,193,183,0.06) 0%, transparent 100%);
            }
            .landing-hero h1 {
                font-size: 3em;
                margin-bottom: 16px;
                background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                animation: heroFade 0.8s ease-out;
            }
            @keyframes heroFade {
                from { opacity: 0; transform: translateY(-20px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .landing-hero p {
                color: var(--text-secondary);
                font-size: 1.2em;
                max-width: 520px;
                margin: 0 auto 32px;
                animation: heroFade 0.8s ease-out 0.15s both;
            }
            .landing-hero .btn {
                max-width: 280px;
                margin: 0 auto;
                animation: heroFade 0.8s ease-out 0.3s both;
            }
            .landing-categories { padding: 40px 24px; max-width: 1100px; margin: 0 auto; }
            .landing-categories h2 {
                text-align: center;
                font-size: 1.8em;
                margin-bottom: 8px;
                color: var(--text-primary);
            }
            .landing-categories .subtitle {
                text-align: center;
                color: var(--text-secondary);
                margin-bottom: 28px;
            }
            .category-tabs {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 8px;
                margin-bottom: 28px;
                padding: 8px;
                background: var(--bg-subtle);
                border-radius: 14px;
                border: 1px solid var(--border-light);
                box-shadow: inset 0 1px 2px rgba(0,0,0,0.04);
            }
            .category-tab {
                padding: 10px 18px;
                border: none;
                background: transparent;
                border-radius: 10px;
                font-size: 0.95em;
                font-weight: 500;
                color: var(--text-secondary);
                cursor: pointer;
                transition: all 0.25s ease;
                display: flex;
                align-items: center;
                gap: 6px;
            }
            .category-tab:hover {
                color: var(--accent);
                background: rgba(56,193,183,0.1);
            }
            .category-tab.active {
                background: var(--accent);
                color: white;
            }
            .category-panel {
                display: none;
                animation: panelFade 0.3s ease;
            }
            .category-panel.active {
                display: block;
            }
            @keyframes panelFade {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            .category-panel h3 {
                font-size: 1.1em;
                color: var(--text-primary);
                margin-bottom: 4px;
            }
            .category-panel .cat-subtitle {
                font-size: 0.9em;
                color: var(--text-secondary);
                margin-bottom: 20px;
            }
            .samples-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 16px;
            }
            .sample-item {
                aspect-ratio: 1;
                border-radius: 14px;
                overflow: hidden;
                border: 2px solid var(--border-light);
                cursor: pointer;
                transition: all 0.25s ease;
                box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            }
            .sample-item:hover {
                border-color: var(--accent);
                transform: scale(1.06);
                box-shadow: 0 8px 24px rgba(56,193,183,0.25);
            }
            .sample-item img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            .ecommerce-zone {
                margin: 48px 24px;
                padding: 32px;
                border: 2px dashed var(--accent);
                border-radius: 16px;
                background: rgba(56,193,183,0.04);
                text-align: center;
            }
            .ecommerce-zone h3 { margin-bottom: 8px; color: var(--text-primary); }
            .ecommerce-zone p { color: var(--text-secondary); margin-bottom: 16px; }
            .ecommerce-zone input {
                width: 100%;
                max-width: 480px;
                padding: 12px 16px;
                border: 1px solid var(--border-light);
                border-radius: 8px;
                margin-bottom: 12px;
                font-size: 1em;
            }
            .ecommerce-zone .btn { max-width: 200px; margin: 0 auto; }
            @media (max-width: 600px) {
                .landing-hero h1 { font-size: 2em; }
                .landing-hero p { font-size: 1em; }
                .category-tabs { gap: 6px; padding: 4px; }
                .category-tab { padding: 8px 12px; font-size: 0.85em; }
                .samples-grid { grid-template-columns: repeat(4, 1fr); gap: 10px; }
                .ecommerce-zone { margin: 24px 16px; padding: 20px; }
            }

            /* ========== Subscription Page ========== */
            .subscription-page { padding: 40px 24px; }
            .subscription-page h2 {
                text-align: center;
                font-size: 2em;
                margin-bottom: 8px;
                color: var(--text-primary);
            }
            .subscription-page .subtitle {
                text-align: center;
                color: var(--text-secondary);
                margin-bottom: 8px;
            }
            .subscription-page .eNach-note {
                text-align: center;
                color: var(--text-secondary);
                font-size: 0.95em;
                margin-bottom: 24px;
            }
            .price-tabs {
                display: flex;
                justify-content: center;
                gap: 0;
                margin-bottom: 28px;
                background: var(--border-light);
                padding: 4px;
                border-radius: 12px;
                max-width: 280px;
                margin-left: auto;
                margin-right: auto;
            }
            .price-tabs button {
                flex: 1;
                padding: 12px 24px;
                border: none;
                background: transparent;
                border-radius: 10px;
                font-size: 1em;
                font-weight: 600;
                color: var(--text-secondary);
                cursor: pointer;
                transition: background 0.2s, color 0.2s;
            }
            .price-tabs button:hover { color: var(--text-primary); }
            .price-tabs button.active {
                background: var(--bg-card);
                color: var(--accent);
                box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            }
            .plans-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
                gap: 24px;
                max-width: 900px;
                margin: 0 auto;
            }
            .plan-card {
                background: var(--bg-card);
                border: 1px solid var(--border-light);
                border-radius: 16px;
                padding: 32px;
                text-align: center;
                transition: box-shadow 0.3s, border-color 0.2s;
            }
            .plan-card.featured {
                border-color: var(--accent);
                box-shadow: 0 8px 24px rgba(56,193,183,0.2);
            }
            .plan-card h3 { margin-bottom: 4px; color: var(--text-primary); }
            .plan-card .plan-desc {
                font-size: 0.9em;
                color: var(--text-secondary);
                margin-bottom: 16px;
            }
            .plan-card .price-row { margin: 16px 0; text-align: center; }
            .plan-card .price-view { display: none; }
            .plan-card .price-view.active { display: block; }
            .plan-card .price { font-size: 1.75em; font-weight: 700; color: var(--accent); }
            .plan-card .price-unit { font-size: 0.65em; font-weight: 400; color: var(--text-secondary); }
            .plan-card ul { list-style: none; text-align: left; color: var(--text-secondary); }
            .plan-card ul li { padding: 8px 0; padding-left: 24px; position: relative; }
            .plan-card ul li::before { content: "‚úì"; color: var(--success); position: absolute; left: 0; }
            .plan-card .btn { margin-top: 20px; width: 100%; }

            .status {
                text-align: center;
                padding: 20px;
                color: var(--text-secondary);
                font-size: 1.1em;
            }

            /* ========== Login / Register ========== */
            .auth-page { max-width: 420px; margin: 0 auto; padding: 40px 24px; }
            .auth-page h2 { text-align: center; margin-bottom: 24px; color: var(--text-primary); }
            .auth-tabs { display: flex; gap: 0; margin-bottom: 24px; background: var(--border-light); padding: 4px; border-radius: 12px; }
            .auth-tabs button { flex: 1; padding: 12px; border: none; background: transparent; border-radius: 10px; font-weight: 600; color: var(--text-secondary); cursor: pointer; transition: all 0.2s; }
            .auth-tabs button.active { background: var(--bg-card); color: var(--accent); box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
            .auth-form label { display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-primary); }
            .auth-form input { width: 100%; padding: 12px 16px; border: 1px solid var(--border-light); border-radius: 8px; margin-bottom: 16px; font-size: 1em; }
            .auth-form .btn { margin-top: 8px; }
            .auth-error { color: #dc2626; font-size: 0.9em; margin-bottom: 12px; }
            .auth-user { color: var(--text-secondary); font-size: 0.95em; margin-right: 12px; }
            .auth-user strong { color: var(--accent); }
            .btn-logout { background: transparent; color: var(--text-secondary); border: 1px solid var(--border-light); padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 0.9em; }
            .btn-logout:hover { background: var(--bg-subtle); color: var(--text-primary); }
            .login-required { background: rgba(56,193,183,0.1); border: 1px solid var(--accent); border-radius: 12px; padding: 20px; text-align: center; margin-bottom: 24px; color: var(--text-primary); }
            .login-required a { color: var(--accent); font-weight: 600; }
            .btn-delete { background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 0.9em; margin-top: 12px; width: 100%; max-width: 140px; }
            .btn-delete:hover { background: #dc2626; }
        </style>
    </head>
    <body>
        <nav class="app-nav">
            <span class="app-nav-brand" id="navBrand">ZAHA AI</span>
            <div class="app-nav-links">
                <a href="#" class="nav-link active" data-page="landing">Home</a>
                <a href="#" class="nav-link" data-page="try-on">Try On</a>
                <a href="#" class="nav-link" data-page="subscription">Subscription</a>
                <span id="authNavWrap">
                    <a href="#" class="nav-link" data-page="login" id="navLogin">Login</a>
                    <span id="authUserSpan" class="hidden"><span class="auth-user" id="authUserName"></span><button type="button" class="btn-logout" id="btnLogout">Logout</button></span>
                </span>
            </div>
        </nav>

        <!-- Landing Page -->
        <section id="page-landing" class="page-section active">
            <div class="landing-hero">
                <h1>Virtual Try-On, Reimagined</h1>
                <p>See how clothes, jewellery, eyewear and more look on you before you buy. Try samples from our closet or paste any e-commerce product link.</p>
                <button class="btn" id="heroTryBtn">Start Try-On</button>
            </div>
            <div class="landing-categories">
                <h2>Browse Sample Closet</h2>
                <p class="subtitle">Choose a category and click any sample to try it on</p>
                <div id="categoryTabs" class="category-tabs"></div>
                <div id="categoryPanels"></div>
            </div>
            <div class="ecommerce-zone" id="ecommerceZone">
                <h3>üõí Drop an E-commerce Product Link</h3>
                <p>Paste any product page URL and we'll extract the product image for virtual try-on</p>
                <input type="url" id="productUrlInput" placeholder="https://example.com/product/..." />
                <button class="btn" id="extractProductBtn">Extract & Try On</button>
                <div id="extractStatus" class="hidden" style="margin-top:12px;color:var(--accent);"></div>
                <div id="extractError" class="hidden" style="margin-top:12px;color:#dc2626;"></div>
            </div>
            <footer class="footer">
                <p>Made by Brandzaha with ‚ù§Ô∏è</p>
                <p class="footer-credit">Made, designed and developed by HIMANSHI SHRIVASTAV</p>
            </footer>
        </section>

        <!-- Login Page -->
        <section id="page-login" class="page-section">
            <div class="auth-page">
                <h2>Welcome to ZAHA AI</h2>
                <div class="auth-tabs">
                    <button type="button" class="auth-tab active" data-tab="login">Login</button>
                    <button type="button" class="auth-tab" data-tab="register">Register</button>
                </div>
                <div id="authError" class="auth-error hidden"></div>
                <form id="authForm" class="auth-form">
                    <label for="authUsername">Username</label>
                    <input type="text" id="authUsername" name="username" required autocomplete="username" />
                    <label for="authPassword">Password</label>
                    <input type="password" id="authPassword" name="password" required autocomplete="current-password" />
                    <button type="submit" class="btn" id="authSubmit">Login</button>
                </form>
            </div>
        </section>

        <!-- Try-On Page -->
        <section id="page-try-on" class="page-section">
        <div class="container">
            <div class="header">
                <h1>üëî Direct Virtual Try-On</h1>
                <p>Upload a person image and a product image to see how it looks</p>
            </div>

            <div class="content">
                <div id="loginRequiredBanner" class="login-required hidden">
                    Please <a href="#" data-page="login" class="nav-link">log in</a> to use Virtual Try-On and see your history.
                </div>
                <div class="input-section">
                    <div class="upload-section">
                        <h2>üë§ Person Image</h2>
                        <div class="upload-area" id="personUploadArea">
                            <div class="upload-icon">üë§</div>
                            <div class="upload-text">Click to upload or drag and drop</div>
                            <div class="upload-hint">Supports: JPG, PNG, GIF, WEBP (max 10MB)</div>
                            <input type="file" id="personFileInput" accept="image/*" />
                            <div class="image-preview-container" id="personPreviewContainer"></div>
                        </div>
                    </div>

                    <div class="upload-section">
                        <h2>üõçÔ∏è Product Image</h2>
                        <div class="upload-area" id="productUploadArea">
                            <div class="upload-icon">üõçÔ∏è</div>
                            <div class="upload-text">Click to upload or drag and drop</div>
                            <div class="upload-hint">Supports: JPG, PNG, GIF, WEBP (max 10MB)</div>
                            <input type="file" id="productFileInput" accept="image/*" />
                            <div class="image-preview-container" id="productPreviewContainer"></div>
                        </div>
                    </div>
                </div>

                <div style="text-align: center">
                    <button class="btn" id="generateBtn" disabled>Generate Virtual Try-On</button>
                </div>

                <div id="status" class="status hidden"></div>
                <div id="error" class="error hidden"></div>
                <div id="loading" class="loading hidden">
                    <div class="spinner"></div>
                    <p>Generating virtual try-on... This may take a minute.</p>
                </div>

                <div id="results" class="results hidden">
                    <div class="result-section">
                        <h3>‚ú® Generated Results</h3>
                        <div class="result-images" id="resultImages"></div>
                    </div>
                </div>
            </div>
            <footer class="footer">
                <p>Made by Brandzaha with ‚ù§Ô∏è</p>
                <p class="footer-credit">Made, designed and developed by HIMANSHI SHRIVASTAV</p>
            </footer>
        </div>
        </section>

        <!-- Subscription Page -->
        <section id="page-subscription" class="page-section">
            <div class="subscription-page">
                <h2>Choose Your Plan</h2>
                <p class="subtitle">Unlock more virtual try-ons and premium features</p>
                <p class="eNach-note"><strong>Note:</strong> With eNach system for monthly plans</p>
                <div class="price-tabs">
                    <button type="button" class="price-tab active" data-billing="monthly">Monthly</button>
                    <button type="button" class="price-tab" data-billing="yearly">Yearly</button>
                </div>
                <div class="plans-grid">
                    <div class="plan-card">
                        <h3>Small Enterprises</h3>
                        <p class="plan-desc">Street shops, local shops</p>
                        <div class="price-row">
                            <div class="price-view active" data-billing="monthly"><span class="price">‚Çπ1,500</span><span class="price-unit">/mo</span></div>
                            <div class="price-view" data-billing="yearly"><span class="price">‚Çπ15,000</span><span class="price-unit"> one time</span></div>
                        </div>
                        <ul>
                            <li>5 try-ons per month</li>
                            <li>Sample closet access</li>
                            <li>Standard quality</li>
                        </ul>
                        <button class="btn">Select Plan</button>
                    </div>
                    <div class="plan-card featured">
                        <h3>Medium Enterprises</h3>
                        <p class="plan-desc">Custom designer, boutiques</p>
                        <div class="price-row">
                            <div class="price-view active" data-billing="monthly"><span class="price">‚Çπ2,000</span><span class="price-unit">/mo</span></div>
                            <div class="price-view" data-billing="yearly"><span class="price">‚Çπ21,500</span><span class="price-unit"> one time</span></div>
                        </div>
                        <ul>
                            <li>Unlimited try-ons</li>
                            <li>Sample closet access</li>
                            <li>HD quality output</li>
                            <li>E-commerce URL extraction</li>
                        </ul>
                        <button class="btn">Select Plan</button>
                    </div>
                    <div class="plan-card">
                        <h3>Large Enterprises</h3>
                        <p class="plan-desc">Maxx, Reliance Lifestyle, Westside, Zudio, Tata Trends</p>
                        <div class="price-row">
                            <div class="price-view active" data-billing="monthly"><span class="price">‚Çπ4,000</span><span class="price-unit">/mo</span></div>
                            <div class="price-view" data-billing="yearly"><span class="price">‚Çπ45,000</span><span class="price-unit"> one time</span></div>
                        </div>
                        <ul>
                            <li>Everything in Medium</li>
                            <li>API access</li>
                            <li>Bulk processing</li>
                            <li>Dedicated support</li>
                        </ul>
                        <button class="btn">Select Plan</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Modal for full-size image with zoom -->
        <div id="imageModal" class="modal">
            <div class="modal-content">
                <span class="modal-close" title="Close">&times;</span>
                <div class="modal-zoom-controls">
                    <button type="button" class="modal-zoom-btn modal-zoom-out" title="Zoom out">‚àí</button>
                    <span class="modal-zoom-level" id="modalZoomLevel">100%</span>
                    <button type="button" class="modal-zoom-btn modal-zoom-in" title="Zoom in">+</button>
                </div>
                <div class="modal-image-container" id="modalImageContainer">
                    <img id="modalImage" src="" alt="Full size image" />
                </div>
            </div>
        </div>

        <script>
            // ============================================================================
            // Constants & Configuration
            // ============================================================================
            const API = {
                VIRTUAL_TRY_ON: '/api/virtual-try-on',
                RESULTS: '/api/results',
                EXTRACT_PRODUCT: '/api/extract-product',
                AUTH_ME: '/api/auth/me',
                AUTH_LOGIN: '/api/auth/login',
                AUTH_REGISTER: '/api/auth/register',
                AUTH_LOGOUT: '/api/auth/logout',
            };
            const fetchOpts = { credentials: 'include' };

            const SAMPLES_DATA = {"categories":[{"id":"sarees","name":"Sarees","subtitle":"Womens Wear","icon":"üëó","samples":["https://images.unsplash.com/photo-1603252109303-2751441dd157?w=400","https://images.unsplash.com/photo-1594633312681-425c7b97ccd1?w=400","https://images.unsplash.com/photo-1595776613215-fe04b78de7d0?w=400","https://images.unsplash.com/photo-1567411622774-74ec98e1d7b2?w=400","https://images.unsplash.com/photo-1572804013309-59a88b7e92f1?w=400"]},{"id":"lehengas-ethnics","name":"Lehengas, Kurti & Ethnics","subtitle":"Womens & Girls Wear","icon":"‚ú®","samples":["https://images.unsplash.com/photo-1595776613215-fe04b78de7d0?w=400","https://images.unsplash.com/photo-1594938298603-c8148c4dae35?w=400","https://images.unsplash.com/photo-1558171813-4c088753af8f?w=400","https://images.unsplash.com/photo-1551488831-00ddcb6c6bd3?w=400","https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=400"]},{"id":"jewellery","name":"Jewellery","subtitle":"Womens Wear","icon":"üíé","samples":["https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400","https://images.unsplash.com/photo-1599643478518-a784e5dc4c8f?w=400","https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=400","https://images.unsplash.com/photo-1611652022419-a9419f74343a?w=400","https://images.unsplash.com/photo-1611085583191-a3b181a88401?w=400"]},{"id":"mens-wear","name":"Shorts, Shirts, T-shirts & Formals","subtitle":"Mens Wear","icon":"üëî","samples":["https://images.unsplash.com/photo-1558171813-4c088753af8f?w=400","https://images.unsplash.com/photo-1598033129183-c4f50c736f10?w=400","https://images.unsplash.com/photo-1596755094514-f87e34085b2c?w=400","https://images.unsplash.com/photo-1617137968427-85924c800a22?w=400","https://images.unsplash.com/photo-1620012253295-c15cc3e65df4?w=400"]},{"id":"eyewear","name":"Eyewear","subtitle":"Unisex","icon":"üï∂Ô∏è","samples":["https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=400","https://images.unsplash.com/photo-1511499767150-a48a237f0083?w=400","https://images.unsplash.com/photo-1574258495973-f010dfbb5371?w=400","https://images.unsplash.com/photo-1473496169904-658ba7c44d8a?w=400","https://images.unsplash.com/photo-1577803645773-f96470509666?w=400"]},{"id":"accessories","name":"Accessories","subtitle":"Belts, Ties, Hats, Brooch","icon":"üé©","samples":["https://images.unsplash.com/photo-1624222247344-550fb60583dc?w=400","https://images.unsplash.com/photo-1582555172866-f73bb12a2ab3?w=400","https://images.unsplash.com/photo-1521369909029-2afed882baee?w=400","https://images.unsplash.com/photo-1588850561407-ed78c282e89b?w=400","https://images.unsplash.com/photo-1591047139829-d91aecb6caea?w=400"]},{"id":"watches","name":"Watches","subtitle":"Luxury & Casual","icon":"‚åö","samples":["https://images.unsplash.com/photo-1524592094714-0f0654e20314?w=400","https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=400","https://images.unsplash.com/photo-1542496658-e33a6d0d50f6?w=400","https://images.unsplash.com/photo-1587836374828-4dbafa94cf0e?w=400","https://images.unsplash.com/photo-1612817159949-195b6eb9e31a?w=400"]},{"id":"makeup","name":"Makeup Shades","subtitle":"Lipstick, Blush & More","icon":"üíÑ","samples":["https://images.unsplash.com/photo-1596462502278-27bfdc403348?w=400","https://images.unsplash.com/photo-1611080626919-7cf5a9dbab5b?w=400","https://images.unsplash.com/photo-1522335789203-aabd1fc54bc9?w=400","https://images.unsplash.com/photo-1596476135970-2e0152096822?w=400","https://images.unsplash.com/photo-1549465220-1a8b9238cd48?w=400"]}]};

            let prefillProductUrl = null;
            let authUser = null;

            // ============================================================================
            // Auth
            // ============================================================================
            const auth = {
                async check() {
                    try {
                        const res = await fetch(API.AUTH_ME, fetchOpts);
                        if (res.ok) {
                            const data = await res.json();
                            authUser = data.user;
                            return true;
                        }
                    } catch (e) { console.error('Auth check failed', e); }
                    authUser = null;
                    return false;
                },
                updateNav() {
                    const loginLink = document.getElementById('navLogin');
                    const userSpan = document.getElementById('authUserSpan');
                    const userNameEl = document.getElementById('authUserName');
                    const loginBanner = document.getElementById('loginRequiredBanner');
                    if (authUser) {
                        if (loginLink) loginLink.classList.add('hidden');
                        if (userSpan) { userSpan.classList.remove('hidden'); userNameEl.textContent = authUser.username + (authUser.role === 'superadmin' ? ' (admin)' : ''); }
                        if (loginBanner) loginBanner.classList.add('hidden');
                    } else {
                        if (loginLink) loginLink.classList.remove('hidden');
                        if (userSpan) userSpan.classList.add('hidden');
                        if (loginBanner) loginBanner.classList.remove('hidden');
                    }
                },
                async init() {
                    await auth.check();
                    auth.updateNav();
                },
            };

            // ============================================================================
            // Page Navigation
            // ============================================================================
            const navigation = {
                show(pageId) {
                    document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
                    document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
                    const page = document.getElementById('page-' + pageId);
                    const link = document.querySelector('.nav-link[data-page="' + pageId + '"]');
                    if (page) page.classList.add('active');
                    if (link) link.classList.add('active');
                },
                init() {
                    document.getElementById('navBrand').addEventListener('click', () => navigation.show('landing'));
                    document.querySelectorAll('.nav-link').forEach(link => {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            const page = link.getAttribute('data-page');
                            if (page) navigation.show(page);
                        });
                    });
                    document.getElementById('heroTryBtn').addEventListener('click', () => navigation.show('try-on'));
                },
            };

            // Login page: tab switch and form submit
            const authPage = {
                currentTab: 'login',
                init() {
                    document.querySelectorAll('.auth-tab').forEach(btn => {
                        btn.addEventListener('click', () => {
                            authPage.currentTab = btn.dataset.tab;
                            document.querySelectorAll('.auth-tab').forEach(b => b.classList.remove('active'));
                            btn.classList.add('active');
                            document.getElementById('authSubmit').textContent = authPage.currentTab === 'login' ? 'Login' : 'Register';
                            document.getElementById('authPassword').setAttribute('autocomplete', authPage.currentTab === 'login' ? 'current-password' : 'new-password');
                            document.getElementById('authError').classList.add('hidden');
                        });
                    });
                    document.getElementById('authForm').addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const username = document.getElementById('authUsername').value.trim();
                        const password = document.getElementById('authPassword').value;
                        const errEl = document.getElementById('authError');
                        const url = authPage.currentTab === 'login' ? API.AUTH_LOGIN : API.AUTH_REGISTER;
                        errEl.classList.add('hidden');
                        try {
                            const res = await fetch(url, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                credentials: 'include',
                                body: JSON.stringify({ username, password }),
                            });
                            const data = await res.json().catch(() => ({}));
                            if (!res.ok) {
                                errEl.textContent = data.error || (res.status === 401 ? 'Invalid username or password' : 'Failed');
                                errEl.classList.remove('hidden');
                                return;
                            }
                            authUser = data.user;
                            auth.updateNav();
                            navigation.show('try-on');
                        } catch (e) {
                            errEl.textContent = 'Network error';
                            errEl.classList.remove('hidden');
                        }
                    });
                    document.getElementById('btnLogout').addEventListener('click', async () => {
                        await fetch(API.AUTH_LOGOUT, { method: 'POST', ...fetchOpts });
                        authUser = null;
                        auth.updateNav();
                        navigation.show('landing');
                    });
                },
            };

            // ============================================================================
            // Subscription Page - Price Tabs (Monthly / Yearly)
            // ============================================================================
            const priceTabs = {
                switchTo(billing) {
                    document.querySelectorAll('.price-tab').forEach(btn => {
                        btn.classList.toggle('active', btn.dataset.billing === billing);
                    });
                    document.querySelectorAll('.plan-card .price-view').forEach(view => {
                        view.classList.toggle('active', view.dataset.billing === billing);
                    });
                },
                init() {
                    document.querySelectorAll('.price-tab').forEach(btn => {
                        btn.addEventListener('click', () => priceTabs.switchTo(btn.dataset.billing));
                    });
                },
            };

            // ============================================================================
            // Landing Page - Categories & Samples
            // ============================================================================
            const landing = {
                categories: [],
                activeTabIndex: 0,

                loadCategories() {
                    const data = SAMPLES_DATA;
                    if (!data || !data.categories || !data.categories.length) {
                        const panels = document.getElementById('categoryPanels');
                        if (panels) panels.innerHTML = '<p style="text-align:center;color:var(--text-secondary);">Sample closet loading soon. Use Direct Try-On for now.</p>';
                        return;
                    }
                    landing.categories = data.categories;

                        const tabsContainer = document.getElementById('categoryTabs');
                        const panelsContainer = document.getElementById('categoryPanels');

                        if (!tabsContainer || !panelsContainer) return;

                        tabsContainer.innerHTML = data.categories.map((cat, idx) => `
                            <button type="button" class="category-tab ${idx === 0 ? 'active' : ''}" data-index="${idx}">
                                ${cat.icon} ${cat.name}
                            </button>
                        `).join('');

                        panelsContainer.innerHTML = data.categories.map((cat, idx) => `
                            <div class="category-panel ${idx === 0 ? 'active' : ''}" data-index="${idx}">
                                <h3>${cat.icon} ${cat.name}</h3>
                                <p class="cat-subtitle">${cat.subtitle}</p>
                                <div class="samples-grid">
                                    ${cat.samples.map((url, i) => `
                                        <div class="sample-item" data-url="${url}">
                                            <img src="${url}" alt="Sample ${i+1}" loading="lazy" />
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('');

                        tabsContainer.querySelectorAll('.category-tab').forEach(btn => {
                            btn.addEventListener('click', () => {
                                const idx = parseInt(btn.dataset.index, 10);
                                landing.activeTabIndex = idx;
                                tabsContainer.querySelectorAll('.category-tab').forEach(b => b.classList.remove('active'));
                                panelsContainer.querySelectorAll('.category-panel').forEach(p => p.classList.remove('active'));
                                btn.classList.add('active');
                                panelsContainer.querySelector(`.category-panel[data-index="${idx}"]`)?.classList.add('active');
                            });
                        });

                        panelsContainer.querySelectorAll('.sample-item').forEach(el => {
                            el.addEventListener('click', () => {
                                prefillProductUrl = el.dataset.url;
                                navigation.show('try-on');
                                fileHandler.setProductFromUrl(prefillProductUrl);
                            });
                        });
                },
            };

            // ============================================================================
            // E-commerce URL Extraction
            // ============================================================================
            const ecommerce = {
                async extractAndTryOn() {
                    const input = document.getElementById('productUrlInput');
                    const statusEl = document.getElementById('extractStatus');
                    const errorEl = document.getElementById('extractError');
                    const url = input?.value?.trim();
                    if (!url) {
                        errorEl.textContent = 'Please enter a product page URL';
                        errorEl.classList.remove('hidden');
                        statusEl.classList.add('hidden');
                        return;
                    }
                    statusEl.textContent = 'Extracting product image...';
                    statusEl.classList.remove('hidden');
                    errorEl.classList.add('hidden');
                    document.getElementById('extractProductBtn').disabled = true;
                    try {
                        const res = await fetch(API.EXTRACT_PRODUCT, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            credentials: 'include',
                            body: JSON.stringify({ url }),
                        });
                        const text = await res.text();
                        let data;
                        try {
                            data = text ? JSON.parse(text) : {};
                        } catch {
                            throw new Error('This site blocked the request or returned an error page. Try copying the product image URL directly, or use Direct Try-On and upload the image.');
                        }
                        if (!res.ok) throw new Error(data.error || 'Extraction failed');
                        prefillProductUrl = data.productImageUrl;
                        statusEl.classList.add('hidden');
                        navigation.show('try-on');
                        fileHandler.setProductFromUrl(prefillProductUrl);
                    } catch (err) {
                        statusEl.classList.add('hidden');
                        errorEl.textContent = err.message || 'Could not extract product from URL';
                        errorEl.classList.remove('hidden');
                    }
                    document.getElementById('extractProductBtn').disabled = false;
                },
            };

            // ============================================================================
            // DOM Elements
            // ============================================================================
            const elements = {
                personUploadArea: document.getElementById('personUploadArea'),
                personFileInput: document.getElementById('personFileInput'),
                personPreviewContainer: document.getElementById('personPreviewContainer'),
                productUploadArea: document.getElementById('productUploadArea'),
                productFileInput: document.getElementById('productFileInput'),
                productPreviewContainer: document.getElementById('productPreviewContainer'),
                generateBtn: document.getElementById('generateBtn'),
                resultsDiv: document.getElementById('results'),
                resultImagesDiv: document.getElementById('resultImages'),
                loadingDiv: document.getElementById('loading'),
                errorDiv: document.getElementById('error'),
                statusDiv: document.getElementById('status'),
                imageModal: document.getElementById('imageModal'),
                modalImage: document.getElementById('modalImage'),
                modalImageContainer: document.getElementById('modalImageContainer'),
                modalClose: document.querySelector('.modal-close'),
                modalZoomIn: document.querySelector('.modal-zoom-in'),
                modalZoomOut: document.querySelector('.modal-zoom-out'),
                modalZoomLevel: document.getElementById('modalZoomLevel'),
            };

            // ============================================================================
            // State Management
            // ============================================================================
            const state = {
                personFile: null,
                productFile: null,
                personImagePreview: null,
                productImagePreview: null,
            };

            // ============================================================================
            // Utility Functions
            // ============================================================================
            const utils = {
                escapeHtml(text) {
                    const div = document.createElement('div');
                    div.textContent = text;
                    return div.innerHTML;
                },
            };

            // ============================================================================
            // UI Management
            // ============================================================================
            const ui = {
                showError(message) {
                    elements.errorDiv.textContent = message;
                    elements.errorDiv.classList.remove('hidden');
                },

                hideError() {
                    elements.errorDiv.classList.add('hidden');
                },

                showLoading(message = 'Processing...') {
                    elements.loadingDiv.classList.remove('hidden');
                    elements.statusDiv.classList.remove('hidden');
                    elements.statusDiv.textContent = message;
                },

                hideLoading() {
                    elements.loadingDiv.classList.add('hidden');
                    elements.statusDiv.classList.add('hidden');
                },

                updateGenerateButton() {
                    const hasProduct = state.productFile || prefillProductUrl;
                    elements.generateBtn.disabled = !(state.personFile && hasProduct);
                },

                showStatus(message) {
                    elements.statusDiv.textContent = message;
                    elements.statusDiv.classList.remove('hidden');
                },

                hideStatus() {
                    elements.statusDiv.classList.add('hidden');
                },
            };

            // ============================================================================
            // File Handling
            // ============================================================================
            const fileHandler = {
                handleFileSelect(file, type) {
                    if (!file.type.startsWith('image/')) {
                        ui.showError('Please select an image file');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        if (type === 'person') {
                            state.personFile = file;
                            state.personImagePreview = e.target.result;
                            fileHandler.showImagePreview(
                                state.personImagePreview,
                                elements.personPreviewContainer,
                                'person'
                            );
                            elements.personUploadArea.classList.add('has-image');
                        } else {
                            prefillProductUrl = null;
                            state.productFile = file;
                            state.productImagePreview = e.target.result;
                            fileHandler.showImagePreview(
                                state.productImagePreview,
                                elements.productPreviewContainer,
                                'product'
                            );
                            elements.productUploadArea.classList.add('has-image');
                        }
                        ui.updateGenerateButton();
                    };
                    reader.readAsDataURL(file);
                },

                showImagePreview(imageSrc, container, type) {
                    container.innerHTML = `
                        <img src="${imageSrc}" alt="Preview" class="image-preview">
                        <button class="remove-image" onclick="app.removeImage('${type}')">√ó</button>
                    `;
                },

                removeImage(type) {
                    if (type === 'person') {
                        state.personFile = null;
                        state.personImagePreview = null;
                        elements.personPreviewContainer.innerHTML = '';
                        elements.personFileInput.value = '';
                        elements.personUploadArea.classList.remove('has-image');
                    } else {
                        state.productFile = null;
                        state.productImagePreview = null;
                        prefillProductUrl = null;
                        elements.productPreviewContainer.innerHTML = '';
                        elements.productFileInput.value = '';
                        elements.productUploadArea.classList.remove('has-image');
                    }
                    ui.updateGenerateButton();
                },

                setProductFromUrl(url) {
                    prefillProductUrl = url;
                    state.productFile = null;
                    state.productImagePreview = url;
                    fileHandler.showImagePreview(url, elements.productPreviewContainer, 'product');
                    elements.productUploadArea.classList.add('has-image');
                    ui.updateGenerateButton();
                },

                clearAllImages() {
                    // Clear person image
                    state.personFile = null;
                    state.personImagePreview = null;
                    elements.personPreviewContainer.innerHTML = '';
                    elements.personFileInput.value = '';
                    elements.personUploadArea.classList.remove('has-image');

                    // Clear product image
                    state.productFile = null;
                    state.productImagePreview = null;
                    prefillProductUrl = null;
                    elements.productPreviewContainer.innerHTML = '';
                    elements.productFileInput.value = '';
                    elements.productUploadArea.classList.remove('has-image');

                    // Update button state
                    ui.updateGenerateButton();
                },

                setupFileInput(uploadArea, fileInput, type) {
                    uploadArea.addEventListener('click', () => fileInput.click());

                    uploadArea.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        uploadArea.classList.add('dragover');
                    });

                    uploadArea.addEventListener('dragleave', () => {
                        uploadArea.classList.remove('dragover');
                    });

                    uploadArea.addEventListener('drop', (e) => {
                        e.preventDefault();
                        uploadArea.classList.remove('dragover');
                        if (e.dataTransfer.files.length > 0) {
                            fileHandler.handleFileSelect(e.dataTransfer.files[0], type);
                        }
                    });

                    fileInput.addEventListener('change', (e) => {
                        if (e.target.files.length > 0) {
                            if (type === 'product') prefillProductUrl = null;
                            fileHandler.handleFileSelect(e.target.files[0], type);
                        }
                    });
                },
            };

            // ============================================================================
            // API & Data Management
            // ============================================================================
            const api = {
                async generateVirtualTryOn() {
                    const hasProduct = state.productFile || prefillProductUrl;
                    if (!state.personFile || !hasProduct) return;

                    ui.hideError();
                    ui.showLoading('Generating virtual try-on...');
                    elements.generateBtn.disabled = true;
                    elements.resultsDiv.classList.add('hidden');

                    const formData = new FormData();
                    formData.append('personImage', state.personFile);
                    let productFile = state.productFile;
                    if (!productFile && prefillProductUrl) {
                        try {
                            const imgRes = await fetch(prefillProductUrl);
                            const blob = await imgRes.blob();
                            productFile = new File([blob], 'product.jpg', { type: blob.type || 'image/jpeg' });
                        } catch (e) {
                            formData.append('productImageUrl', prefillProductUrl);
                        }
                    }
                    if (productFile) {
                        formData.append('productImage', productFile);
                    } else if (prefillProductUrl) {
                        formData.append('productImageUrl', prefillProductUrl);
                    }
                    formData.append('sampleCount', '1');

                    try {
                        const response = await fetch(API.VIRTUAL_TRY_ON, {
                            method: 'POST',
                            body: formData,
                            credentials: 'include',
                        });

                        const data = await response.json();

                        if (response.status === 401) {
                            authUser = null;
                            auth.updateNav();
                            throw new Error('Please log in to use Virtual Try-On.');
                        }
                        if (!response.ok) {
                            throw new Error(data.error || 'Failed to generate virtual try-on');
                        }

                        // Clear upload areas after successful generation
                        fileHandler.clearAllImages();

                        results.displayResults(data);
                        ui.hideLoading();
                    } catch (error) {
                        ui.showError(
                            error.message || 'An error occurred while generating virtual try-on'
                        );
                        ui.hideLoading();
                    } finally {
                        elements.generateBtn.disabled = false;
                    }
                },

                async loadAllResults() {
                    if (!authUser) {
                        elements.resultsDiv.classList.add('hidden');
                        return;
                    }
                    try {
                        const response = await fetch(API.RESULTS, fetchOpts);
                        if (response.status === 401) {
                            authUser = null;
                            auth.updateNav();
                            elements.resultsDiv.classList.add('hidden');
                            return;
                        }
                        if (!response.ok) throw new Error('Failed to load results');
                        const data = await response.json();
                        if (data.results && data.results.length > 0) {
                            results.displayAllResults(data.results);
                            elements.resultsDiv.classList.remove('hidden');
                            results.attachDeleteHandlers();
                        } else {
                            elements.resultsDiv.classList.add('hidden');
                        }
                    } catch (error) {
                        console.error('Error loading results:', error);
                        elements.resultsDiv.classList.add('hidden');
                    }
                },
            };

            // ============================================================================
            // Results Display
            // ============================================================================
            const results = {
                displayResults(data) {
                    if (!data.resultImages || data.resultImages.length === 0) {
                        ui.showError('No results generated');
                        return;
                    }
                    api.loadAllResults();
                },

                displayAllResults(resultsArray) {
                    elements.resultImagesDiv.innerHTML = resultsArray
                        .map(
                            (result) => `
                        <div class="result-card" data-result-id="${result.id}">
                            <div class="result-grid">
                                <div class="result-grid-item">
                                    <h4>üë§ Person</h4>
                                    <div class="result-image-wrapper">
                                        <img src="${utils.escapeHtml(result.personImageUrl)}" alt="Person Image" class="result-image-clickable" data-image-url="${utils.escapeHtml(result.personImageUrl)}">
                                    </div>
                                </div>
                                <div class="result-grid-item">
                                    <h4>üõçÔ∏è Product</h4>
                                    <div class="result-image-wrapper">
                                        <img src="${utils.escapeHtml(result.productImageUrl)}" alt="Product Image" class="result-image-clickable" data-image-url="${utils.escapeHtml(result.productImageUrl)}">
                                    </div>
                                </div>
                                <div class="result-grid-item">
                                    <h4>‚ú® Result</h4>
                                    <div class="result-image-wrapper">
                                        <img src="${utils.escapeHtml(result.resultImages[0])}" alt="Virtual Try-On Result" class="result-image-clickable" data-image-url="${utils.escapeHtml(result.resultImages[0])}">
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn-delete" data-delete-id="${result.id}" title="Remove from history permanently">Delete</button>
                        </div>
                    `
                        )
                        .join('');

                    results.attachImageClickHandlers();
                },

                attachDeleteHandlers() {
                    elements.resultImagesDiv.querySelectorAll('.btn-delete[data-delete-id]').forEach(btn => {
                        btn.addEventListener('click', async () => {
                            const id = btn.getAttribute('data-delete-id');
                            if (!id || !confirm('Remove this try-on from history permanently?')) return;
                            try {
                                const res = await fetch(`${API.RESULTS}/${id}`, { method: 'DELETE', ...fetchOpts });
                                if (!res.ok) {
                                    const d = await res.json().catch(() => ({}));
                                    alert(d.error || 'Failed to delete');
                                    return;
                                }
                                api.loadAllResults();
                            } catch (e) {
                                alert('Failed to delete');
                            }
                        });
                    });
                },

                attachImageClickHandlers() {
                    const clickableImages =
                        elements.resultImagesDiv.querySelectorAll('.result-image-clickable');
                    clickableImages.forEach((img) => {
                        img.addEventListener('click', () => {
                            const imageUrl = img.getAttribute('data-image-url');
                            modal.open(imageUrl);
                        });
                    });
                },
            };

            // ============================================================================
            // Modal Management
            // ============================================================================
            const modal = {
                zoomLevel: 1,
                minZoom: 0.5,
                maxZoom: 4,
                zoomStep: 0.25,

                open(imageUrl) {
                    elements.modalImage.src = imageUrl;
                    elements.imageModal.classList.add('show');
                    document.body.style.overflow = 'hidden';
                    modal.zoomLevel = 1;
                    modal.updateZoom();
                },

                close() {
                    elements.imageModal.classList.remove('show');
                    document.body.style.overflow = '';
                    modal.zoomLevel = 1;
                },

                updateZoom() {
                    elements.modalImage.style.transform = `scale(${modal.zoomLevel})`;
                    if (elements.modalZoomLevel) {
                        elements.modalZoomLevel.textContent = Math.round(modal.zoomLevel * 100) + '%';
                    }
                },

                zoomIn() {
                    modal.zoomLevel = Math.min(modal.maxZoom, modal.zoomLevel + modal.zoomStep);
                    modal.updateZoom();
                },

                zoomOut() {
                    modal.zoomLevel = Math.max(modal.minZoom, modal.zoomLevel - modal.zoomStep);
                    modal.updateZoom();
                },

                init() {
                    elements.modalClose.addEventListener('click', () => modal.close());

                    elements.imageModal.addEventListener('click', (e) => {
                        if (e.target === elements.imageModal) modal.close();
                    });

                    document.addEventListener('keydown', (e) => {
                        if (e.key === 'Escape' && elements.imageModal.classList.contains('show')) {
                            modal.close();
                        }
                    });

                    if (elements.modalZoomIn) {
                        elements.modalZoomIn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            modal.zoomIn();
                        });
                    }
                    if (elements.modalZoomOut) {
                        elements.modalZoomOut.addEventListener('click', (e) => {
                            e.stopPropagation();
                            modal.zoomOut();
                        });
                    }

                    if (elements.modalImageContainer) {
                        elements.modalImageContainer.addEventListener('wheel', (e) => {
                            if (!elements.imageModal.classList.contains('show')) return;
                            e.preventDefault();
                            if (e.deltaY < 0) modal.zoomIn();
                            else modal.zoomOut();
                        }, { passive: false });
                    }
                },
            };

            // ============================================================================
            // Application Initialization
            // ============================================================================
            const app = {
                async init() {
                    navigation.init();
                    priceTabs.init();
                    authPage.init();
                    await auth.init();
                    landing.loadCategories();
                    document.getElementById('extractProductBtn').addEventListener('click', () => ecommerce.extractAndTryOn());
                    fileHandler.setupFileInput(
                        elements.personUploadArea,
                        elements.personFileInput,
                        'person'
                    );
                    fileHandler.setupFileInput(
                        elements.productUploadArea,
                        elements.productFileInput,
                        'product'
                    );
                    elements.generateBtn.addEventListener('click', api.generateVirtualTryOn);
                    modal.init();
                    api.loadAllResults();
                },

                removeImage(type) {
                    fileHandler.removeImage(type);
                },
            };

            // Make removeImage available globally for onclick handlers
            window.removeImage = app.removeImage;

            // Start application
            app.init();
        </script>
    </body>
</html>
